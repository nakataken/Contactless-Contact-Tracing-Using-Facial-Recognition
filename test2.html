<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="/public/css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container-fluid" >
        <select class="form-control" id="selectRegion">
        </select>
        <select class="form-control" id="selectProvince">
        </select>
        <select class="form-control" id="selectCity">
        </select>
        <select class="form-control" id="selectBarangay">
        </select>
    </div>
    <script>
        let regionCode = 0 , provinceCode = 0, cityCode = 0;
        let provinces, city, barangay;
        let selectedRegion, selectedProvince, selectedCity, selectedBarangay;

        fetch('/public/json/regions.json').then(response=>response.json()).then(data => getRegion(data))
        fetch('/public/json/provinces.json').then(response=>response.json()).then(data =>provinces = data)
        fetch('/public/json/city-mun.json').then(response=>response.json()).then(data =>city = data)
        fetch('/public/json/barangays.json').then(response=>response.json()).then(data =>barangay = data)

        function  getRegion  (data) {
            var jsonList = {"Table" : data}
            $(document).ready(function(){
            var listItems= "";
            for (var i = 0; i < jsonList.Table.length; i++){
                listItems+= "<option data-region='" + jsonList.Table[i].name + "' value='" + jsonList.Table[i].reg_code + "'>" + jsonList.Table[i].name + "</option>";
            }
                $("#selectRegion").html(listItems);
                $("#selectProvince").html("");
                $("#selectCity").html("");
                $("#selectBarangay").html("");
            });    
        }

        $('#selectRegion').on('change', function (e) {
            var optionSelected = $("option:selected.code", this);
            regionCode = this.value;
            selectedRegion = $(this).find(':selected').data('region');

            var jsonList = {"Table" : provincefilteredItems(regionCode) }
           
            $(document).ready(function(){
                var listItems= "";
                for (var i = 0; i < jsonList.Table.length; i++){
                    listItems+= "<option data-province='" + jsonList.Table[i].name + "' value='" + jsonList.Table[i].prov_code + "'>" + jsonList.Table[i].name + "</option>";
                }
                $("#selectProvince").html(listItems);
                $("#selectCity").html("");
                $("#selectBarangay").html("");
            });  
        })

        $('#selectProvince').on('change', function (e) {
            var optionSelected = $("option:selected", this);
            provinceCode = this.value;
            selectedProvince = $(this).find(':selected').data('province');

            var jsonList = {"Table" : cityfilteredItems(provinceCode) }

            $(document).ready(function(){
            var listItems= "";
            for (var i = 0; i < jsonList.Table.length; i++){
                listItems+= "<option data-city='" + jsonList.Table[i].name + "' value='" + jsonList.Table[i].mun_code + "'>" + jsonList.Table[i].name + "</option>";
            }
                $("#selectCity").html(listItems);
                $("#selectBarangay").html("");
            });  
        })

        $('#selectCity').on('change', function (e) {
            var optionSelected = $("option:selected", this);
            cityCode = this.value;
            selectedCity = $(this).find(':selected').data('city');

            var jsonList = {"Table" : barangayfilteredItems(cityCode) }

            $(document).ready(function(){
            var listItems= "";
            for (var i = 0; i < jsonList.Table.length; i++){
                listItems+= "<option data-barangay='" + jsonList.Table[i].name + "' value='" + jsonList.Table[i].name + "'>" + jsonList.Table[i].name + "</option>";
            }
                $("#selectBarangay").html(listItems);
            });  

            console.log(selectedRegion )
            console.log(selectedProvince)
            console.log(selectedCity)
            console.log(selectedBarangay )
        })
        
        $('#selectBarangay').on('change', function (e) {
            selectedCity = $(this).find(':selected').data('barangay');
        })
        
        function provincefilteredItems(regionCode){
            return provinces.filter(function(el) {return el.reg_code === regionCode;});
        }
        function cityfilteredItems(provinceCode){
            return city.filter(function(el) {return el.prov_code === provinceCode;});
        }
        function barangayfilteredItems(cityCode){
            return barangay.filter(function(el) {return el.mun_code === cityCode;});
        }
    </script>   
</body>
</html>

